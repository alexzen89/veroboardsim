<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Perfboard Simulator</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        background: #eee;
      }
      #perfboard {
        background: #d4a373;
        border: 1px solid #999;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <label style="margin: 10px">
      Select Wire Color:
      <input
        type="color"
        id="colorPicker"
        value="#ff0000"
        style="margin-left: 10px"
      />
    </label>

    <svg id="perfboard" width="750" height="550"></svg>

    <script>
      const rows = 20;
      const cols = 30;
      const spacing = 20;
      const holeRadius = 3;
      const offsetX = 30;
      const offsetY = 30;
      const stripGap = 4;

      const svg = document.getElementById("perfboard");
      const colorPicker = document.getElementById("colorPicker");
      let selected = null;
      const connections = [];

      function createElementNS(type, attrs) {
        const elem = document.createElementNS(
          "http://www.w3.org/2000/svg",
          type
        );
        for (let attr in attrs) {
          elem.setAttribute(attr, attrs[attr]);
        }
        return elem;
      }

      // Layer 1: Copper strips (background)
      const stripGroup = createElementNS("g", {});
      for (let row = 0; row < rows; row++) {
        const y = offsetY + row * spacing - (holeRadius + stripGap);
        const rect = createElementNS("rect", {
          x: offsetX - spacing / 2,
          y: y,
          width: cols * spacing + spacing,
          height: (holeRadius + stripGap) * 2,
          fill: "#c67134",
          rx: "2",
        });
        stripGroup.appendChild(rect);
      }
      svg.appendChild(stripGroup);

      // Layer 2: Wire group
      const wireGroup = createElementNS("g", {});
      svg.appendChild(wireGroup);

      // Layer 3: Hole group
      const holeGroup = createElementNS("g", {});
      svg.appendChild(holeGroup);

      // Create holes and interaction
      for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
          const x = offsetX + col * spacing;
          const y = offsetY + row * spacing;
          const circle = createElementNS("circle", {
            cx: x,
            cy: y,
            r: holeRadius,
            fill: "black",
            style: "cursor: pointer;",
          });

          circle.addEventListener("click", () => {
            if (!selected) {
              selected = { row, col, coord: [x, y], element: circle };
              circle.setAttribute("fill", "orange");
            } else {
              const isSameStrip = selected.row === row;
              if (!isSameStrip) {
                const line = createElementNS("line", {
                  x1: selected.coord[0],
                  y1: selected.coord[1],
                  x2: x,
                  y2: y,
                  stroke: colorPicker.value,
                  "stroke-width": 5,
                });
                wireGroup.appendChild(line); // wires above strips
                connections.push({
                  from: selected.coord,
                  to: [x, y],
                  color: colorPicker.value,
                });
              }
              selected.element.setAttribute("fill", "black");
              selected = null;
            }
          });

          holeGroup.appendChild(circle);
        }
      }
    </script>
  </body>
</html>
